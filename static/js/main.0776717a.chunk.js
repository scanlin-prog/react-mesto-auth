(this["webpackJsonpreact-mesto-auth"]=this["webpackJsonpreact-mesto-auth"]||[]).push([[0],{20:function(e,t,a){e.exports=a.p+"static/media/Mesto.c6f11019.svg"},22:function(e,t,a){e.exports=a.p+"static/media/Success.e38b395c.svg"},23:function(e,t,a){e.exports=a.p+"static/media/Fail.4072126c.svg"},26:function(e,t,a){e.exports=a(37)},31:function(e,t,a){},37:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),c=a(17),r=a.n(c),l=a(7),i=(a(31),a(24)),s=a(1),u=o.a.createContext(),p=a(18),m=a(19),d=new(function(){function e(t){Object(p.a)(this,e),this._baseurl=t.baseUrl,this._headers=t.headers}return Object(m.a)(e,[{key:"_handleResponse",value:function(e){return e.ok?e.json():(console.log("_handleResponse rejection"),Promise.reject(e.statusText))}},{key:"getProfileData",value:function(){return fetch("".concat(this._baseurl,"/users/me"),{headers:this._headers}).then(this._handleResponse)}},{key:"sendProfileData",value:function(e){return fetch("".concat(this._baseurl,"/users/me"),{headers:this._headers,method:"PATCH",body:JSON.stringify(e)}).then(this._handleResponse)}},{key:"getCardsData",value:function(){return fetch("".concat(this._baseurl,"/cards"),{headers:this._headers}).then(this._handleResponse)}},{key:"sendCardData",value:function(e){return fetch("".concat(this._baseurl,"/cards"),{headers:this._headers,method:"POST",body:JSON.stringify(e)}).then(this._handleResponse)}},{key:"toggleLikeCard",value:function(e,t){return fetch("".concat(this._baseurl,"/cards/").concat(e,"/likes"),{headers:this._headers,method:t?"PUT":"DELETE"}).then(this._handleResponse)}},{key:"deleteCard",value:function(e){return fetch("".concat(this._baseurl,"/cards/").concat(e),{headers:this._headers,method:"DELETE"}).then(this._handleResponse)}},{key:"changeAvatar",value:function(e){var t=e.link;return fetch("".concat(this._baseurl,"/users/me/avatar"),{headers:this._headers,method:"PATCH",body:JSON.stringify({avatar:t})}).then(this._handleResponse)}}]),e}())({baseUrl:"http://localhost:3001",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}}),_=a(20),h=a.n(_);var f=function(e){return o.a.createElement(o.a.Fragment,null,o.a.createElement("header",{className:"header"},o.a.createElement("img",{className:"header__logo",src:h.a,alt:"\u041c\u0435\u0441\u0442\u043e"}),o.a.createElement("div",{className:"header__profile"},e.children,o.a.createElement(l.b,{to:e.sign,onClick:e.handleLogout,className:"header__link"},e.signLink))))},g="http://localhost:3001";function E(e){return e.ok?e.json():(console.log("_handleResponse rejection"),Promise.reject(e.statusText))}var v=function(e){var t=o.a.useState(""),a=Object(s.a)(t,2),n=a[0],c=a[1],r=o.a.useState(""),i=Object(s.a)(r,2),u=i[0],p=i[1];return o.a.createElement(o.a.Fragment,null,o.a.createElement(f,{sign:"/sign-up",signLink:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"}),o.a.createElement("div",{className:"login"},o.a.createElement("p",{className:"login__welcome"},"\u0412\u0445\u043e\u0434"),o.a.createElement("form",{onSubmit:function(t){t.preventDefault(),n&&u?function(e,t){return fetch("".concat(g,"/signin"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then(E)}(n,u).then((function(t){t.token&&(localStorage.setItem("token",t.token),e.handleLogin(),c(""),p(""))})).catch((function(){return alert("\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0441 email \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d")})):alert("\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 email \u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c")},className:"login__form"},o.a.createElement("input",{required:!0,className:"login__input",onChange:function(e){var t=e.target.value;c(t)},name:"email",type:"email",placeholder:"Email"}),o.a.createElement("input",{required:!0,className:"login__input",onChange:function(e){var t=e.target.value;p(t)},name:"password",type:"password",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c"}),o.a.createElement("button",{type:"submit",className:"login__link"},"\u0412\u043e\u0439\u0442\u0438")),o.a.createElement("div",{className:"login__signup"},o.a.createElement("p",null,"\u0415\u0449\u0451 \u043d\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b?"),o.a.createElement(l.b,{to:"/sign-up",className:"login__signup-link"},"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"))))},b=a(2);var N=function(e){var t=o.a.useState(""),a=Object(s.a)(t,2),n=a[0],c=a[1],r=o.a.useState(""),i=Object(s.a)(r,2),u=i[0],p=i[1],m=o.a.useState(""),d=Object(s.a)(m,2),_=d[0],h=d[1],v=o.a.useState(""),N=Object(s.a)(v,2),C=N[0],k=N[1],y=o.a.useState(""),O=Object(s.a)(y,2),j=O[0],S=O[1],L=Object(b.g)();return o.a.createElement(o.a.Fragment,null,o.a.createElement(f,{sign:"/sign-in",signLink:"\u0412\u043e\u0439\u0442\u0438"}),o.a.createElement("div",{className:"login"},o.a.createElement("p",{className:"login__welcome"},"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),o.a.createElement("form",{onSubmit:function(t){t.preventDefault(),function(e,t,a,n,o){return fetch("".concat(g,"/signup"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,name:a,about:n,avatar:o})}).then(E)}(n,u,_,C,j).then((function(t){t?(e.openInfoTooltip(!0,"\u0412\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c!"),L.push("/sign-in")):e.openInfoTooltip(!1,"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437.")})).catch((function(){return alert("\u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e \u043e\u0434\u043d\u043e \u0438\u0437 \u043f\u043e\u043b\u0435\u0439")}))},className:"login__form"},o.a.createElement("input",{required:!0,className:"login__input",onChange:function(e){var t=e.target.value;c(t)},name:"email",type:"email",placeholder:"Email"}),o.a.createElement("input",{required:!0,className:"login__input",onChange:function(e){var t=e.target.value;p(t)},name:"password",type:"password",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c"}),o.a.createElement("input",{required:!0,className:"login__input",onChange:function(e){var t=e.target.value;h(t)},name:"name",type:"text",placeholder:"\u0418\u043c\u044f"}),o.a.createElement("input",{required:!0,className:"login__input",onChange:function(e){var t=e.target.value;k(t)},name:"about",type:"text",placeholder:"\u041e \u0441\u0435\u0431\u0435"}),o.a.createElement("input",{required:!0,className:"login__input",onChange:function(e){var t=e.target.value;S(t)},name:"avatar",type:"url",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0430\u0432\u0430\u0442\u0430\u0440"}),o.a.createElement("button",{type:"submit",className:"login__link"},"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f")),o.a.createElement("div",{className:"login__signup"},o.a.createElement("p",null,"\u0423\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b?"),o.a.createElement(l.b,{to:"/sign-in",className:"login__signup-link"},"\u0412\u043e\u0439\u0442\u0438"))))};var C=function(e){var t=o.a.useContext(u),a=e.card.owner._id===t._id,n="place__button-remove ".concat(a?"place__button-remove_active":""),c=e.card.likes.some((function(e){return e._id===t._id})),r="place__button-like ".concat(c?"place__button-like_active":"");return o.a.createElement("div",{className:"place"},o.a.createElement("img",{className:"place__image",src:e.card.link,onClick:function(){e.onCardClick(e.card)},alt:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"}),o.a.createElement("h3",{className:"place__title"},e.card.name),o.a.createElement("div",{className:"place__field-like"},o.a.createElement("button",{className:r,type:"button",onClick:function(){e.onCardLike(e.card)}}),o.a.createElement("p",{className:"place__button-like-number"},e.card.likes.length)),o.a.createElement("button",{className:n,type:"button",onClick:function(){e.onCardDelete(e.card)}}))};var k=function(e){var t=o.a.useContext(u);return o.a.createElement(o.a.Fragment,null,o.a.createElement(f,{sign:"/sign-in",signLink:"\u0412\u044b\u0439\u0442\u0438",handleLogout:e.handleLogout},o.a.createElement("p",{className:"header__nickname"},e.user.email)),o.a.createElement("main",{className:"content"},o.a.createElement("section",{className:"profile"},o.a.createElement("img",{className:"profile__avatar",src:t.avatar,alt:"\u041b\u0438\u0446\u043e"}),o.a.createElement("div",{className:"profile__overlay",onClick:e.onEditAvatar}),o.a.createElement("div",{className:"profile__info"},o.a.createElement("div",{className:"profile__info-heading"},o.a.createElement("h1",{className:"profile__info-title"},t.name),o.a.createElement("button",{className:"profile__button-edit",onClick:e.onEditProfile,type:"button"})),o.a.createElement("p",{className:"profile__info-subtitle"},t.about)),o.a.createElement("button",{className:"profile__button-add",onClick:e.onAddPlace,type:"button"})),o.a.createElement("section",{className:"places"},e.cards.map((function(t){return o.a.createElement(C,{card:t,key:t._id,onCardClick:e.onCardClick,onCardLike:e.onCardLike,onCardDelete:e.onCardDelete})})))))};var y=function(){return o.a.createElement("footer",{className:"footer"},o.a.createElement("p",{className:"footer__copyright"},"\xa9 2020. \u0418\u0432\u0430\u043d \u0420\u043e\u0442\u0430\u0440\u044c"))};var O=function(e){return o.a.createElement("div",{className:"popup ".concat(e.isOpen?"popup_opened":""),id:"popup-".concat(e.name)},o.a.createElement("form",{className:"popup__container",name:"popup-window",onSubmit:e.onSubmit,noValidate:!0},o.a.createElement("h3",{className:"popup__title"},e.title),e.children,o.a.createElement("button",{className:"popup__button-create"},e.titleButton),o.a.createElement("button",{className:"popup__button-close",type:"button",onClick:e.onClose})))};var j=function(e){var t=o.a.useState(""),a=Object(s.a)(t,2),n=a[0],c=a[1],r=o.a.useState(""),l=Object(s.a)(r,2),i=l[0],p=l[1],m=o.a.useContext(u);return o.a.useEffect((function(){c(m.name),p(m.about)}),[m,e.isOpen]),o.a.createElement(O,{name:"edit",title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c",titleButton:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onUpdateUser({name:n,about:i})}},o.a.createElement("label",{className:"popup__field"},o.a.createElement("input",{type:"text",value:n||"",onChange:function(e){c(e.target.value)},className:"popup__input popup__input_first",id:"name-input",placeholder:"\u0418\u043c\u044f",name:"name",required:!0,minLength:"2",maxLength:"40"}),o.a.createElement("span",{className:"popup__input-error",id:"name-input-error"})),o.a.createElement("label",{className:"popup__field"},o.a.createElement("input",{type:"text",value:i||"",onChange:function(e){p(e.target.value)},className:"popup__input popup__input_second",id:"job-input",placeholder:"\u041e \u0441\u0435\u0431\u0435",name:"about",required:!0,minLength:"2",maxLength:"200"}),o.a.createElement("span",{className:"popup__input-error",id:"job-input-error"})))};var S=function(e){var t=o.a.useRef();return o.a.createElement(O,{name:"avatar",title:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",titleButton:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(a){a.preventDefault(),e.onUpdateAvatar({link:t.current.value})}},o.a.createElement("label",{className:"popup__field"},o.a.createElement("input",{type:"url",className:"popup__input popup__input_second",id:"url-input",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",name:"link",ref:t,required:!0}),o.a.createElement("span",{className:"popup__input-error",id:"url-input-error"})))};var L=function(e){var t=o.a.useRef(),a=o.a.useRef();return o.a.createElement(O,{name:"add",title:"\u041d\u043e\u0432\u043e\u0435 \u043c\u0435\u0441\u0442\u043e",titleButton:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(n){n.preventDefault(),e.onAddPlace({name:t.current.value,link:a.current.value})}},o.a.createElement("label",{className:"popup__field"},o.a.createElement("input",{type:"text",className:"popup__input popup__input_first",id:"title-input",placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",name:"name",ref:t,required:!0,minLength:"1",maxLength:"30"}),o.a.createElement("span",{className:"popup__input-error",id:"title-input-error"})),o.a.createElement("label",{className:"popup__field"},o.a.createElement("input",{type:"url",className:"popup__input popup__input_second",id:"url-input",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",name:"link",ref:a,required:!0}),o.a.createElement("span",{className:"popup__input-error",id:"url-input-error"})))};var P=function(e){return o.a.createElement("div",{className:"popup ".concat(e.card&&"popup_opened"),id:"popup-image"},o.a.createElement("div",{className:"popup__container-image"},o.a.createElement("p",{className:"popup__image-title"},e.card?e.card.name:""),o.a.createElement("img",{className:"popup__image",src:e.card?e.card.link:"",alt:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"}),o.a.createElement("button",{className:"popup__button-close popup__button-close_theme_image",onClick:e.onClose,type:"button"})))},x=a(22),w=a.n(x),D=a(23),T=a.n(D);var A=function(e){return o.a.createElement("div",{className:"popup ".concat(e.isOpen?"popup_opened":"")},o.a.createElement("div",{className:"popup__container"},o.a.createElement("img",{className:"popup__info-image",src:e.infoPopup.image?w.a:T.a,alt:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"}),o.a.createElement("p",{className:"popup__info-title"},e.infoPopup.text),o.a.createElement("button",{className:"popup__button-close",onClick:e.onClose,type:"button"})))},R=a(25),q=function(e){var t=e.component,a=Object(R.a)(e,["component"]);return o.a.createElement(b.b,null,(function(){return a.loggedIn?o.a.createElement(t,a):o.a.createElement(b.a,{to:"/sign-in"})}))};var I=function(){var e=o.a.useState(!1),t=Object(s.a)(e,2),a=t[0],n=t[1],c=o.a.useState(!1),r=Object(s.a)(c,2),l=r[0],p=r[1],m=o.a.useState(!1),_=Object(s.a)(m,2),h=_[0],f=_[1],C=o.a.useState(!1),x=Object(s.a)(C,2),w=x[0],D=x[1],T=o.a.useState(void 0),R=Object(s.a)(T,2),I=R[0],B=R[1],U=o.a.useState({}),J=Object(s.a)(U,2),F=J[0],z=J[1],H=o.a.useState([]),M=Object(s.a)(H,2),W=M[0],G=M[1],V=o.a.useState(!1),$=Object(s.a)(V,2),K=$[0],Q=$[1],X=o.a.useState({}),Y=Object(s.a)(X,2),Z=Y[0],ee=Y[1],te=Object(b.g)();function ae(){p(!1),n(!1),f(!1),B(void 0),D(!1)}function ne(){var e=localStorage.getItem("token");e&&function(e){return fetch("".concat(g,"/users/me"),{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then(E)}(e).then((function(e){e&&(Q(!0),z(e),te.push("/main"))})).catch((function(){alert("\u041f\u0435\u0440\u0435\u0434\u0430\u043d\u043d\u044b\u0439 \u0442\u043e\u043a\u0435\u043d \u043d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u0435\u043d")}))}return o.a.useEffect((function(){ne(),d.getProfileData().then((function(e){z(e)})).catch((function(e){console.log(e)})),d.getCardsData().then((function(e){G(e)})).catch((function(e){console.log(e)}))}),[]),o.a.createElement("div",{className:"page"},o.a.createElement(u.Provider,{value:F},o.a.createElement(b.d,null,o.a.createElement(q,{path:"/main",loggedIn:K,user:F,component:k,handleLogout:function(){localStorage.removeItem("token"),Q(!1)},onEditProfile:function(){p(!0)},onAddPlace:function(){f(!0)},onEditAvatar:function(){n(!0)},onCardClick:function(e){B(e)},cards:W,onCardLike:function(e){var t=e.likes.some((function(e){return e._id===F._id}));d.toggleLikeCard(e._id,!t).then((function(t){var a=W.map((function(a){return a._id===e._id?t:a}));G(a)})).catch((function(e){console.log(e)}))},onCardDelete:function(e){d.deleteCard(e._id).then((function(){var t=W.filter((function(t){return t._id!==e._id}));G(t)})).catch((function(e){console.log(e)}))}}),o.a.createElement(b.b,{path:"/sign-up"},o.a.createElement(N,{openInfoTooltip:function(e,t){ee({image:e,text:t}),setTimeout(D,300,!0)}})),o.a.createElement(b.b,{path:"/sign-in"},o.a.createElement(v,{handleLogin:function(){ne()}})),o.a.createElement(b.b,{exact:!0,path:"/"},K?o.a.createElement(b.a,{to:"/main"}):o.a.createElement(b.a,{to:"/sign-in"}))),o.a.createElement(y,null),o.a.createElement(j,{isOpen:l,onClose:ae,onUpdateUser:function(e){d.sendProfileData(e).then((function(e){z(e),ae()})).catch((function(e){console.log(e)}))}}),o.a.createElement(L,{isOpen:h,onClose:ae,onAddPlace:function(e){d.sendCardData(e).then((function(e){G([e].concat(Object(i.a)(W))),ae()})).catch((function(e){console.log(e)}))}}),o.a.createElement(S,{isOpen:a,onClose:ae,onUpdateAvatar:function(e){d.changeAvatar(e).then((function(e){z(e),ae()})).catch((function(e){console.log(e)}))}}),o.a.createElement(O,{name:"confirm",title:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?",titleButton:"\u0414\u0430"}),o.a.createElement(P,{card:I,onClose:ae}),o.a.createElement(A,{isOpen:w,infoPopup:Z,onClose:ae})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(l.a,null,o.a.createElement(I,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[26,1,2]]]);
//# sourceMappingURL=main.0776717a.chunk.js.map